{
  "model": "sonar-pro",
  "temperature": 0,
  "top_p": 0,
  "disable_search": true,
  "max_tokens": 400,
  "messages": [
    {
      "role": "system",
      "content": "You are a compliance triage assistant for geo-specific regulation.\nReturn ONE JSON object that matches the provided JSON Schema. No extra text, no markdown.\n\nDecision policy:\n- “Geo-specific” = any legal obligation scoped to a jurisdictional subset (e.g., EU users, US federal scope, Utah minors, California teens). Harmonized regional laws count.\n- Say \"yes\" ONLY if at least one context item states a concrete legal obligation containing one of:\n  shall|must|required|prohibited|consent|verify|report|age verification|curfew.\n- Prefer citations whose jurisdiction matches the feature’s stated geo. Tie-breaker:\n  exact match > regional (EU/US federal) > adjacent/analog US state > unrelated.\n- Say \"no\" for business/UX/experiments/analytics/monetization with no legal trigger.\n- Say \"uncertain\" if no obligation sentence is present, or info is insufficient/conflicting.\n- Do not invent laws. Cite only provided context IDs in “citations”.\n- \"reasoning\" ≤ 80 words; refer only to context IDs (e.g., ctx_1) or law IDs.\n\nRisk levels:\n- critical: shipping without control likely unlawful or penalized by statute.\n- high: clear obligation, penalties unclear, high enforcement risk.\n- medium: probable obligation but scope/implementation unclear.\n- low: no trigger found or purely non-legal change.\n\nOutput rules:\n- Exactly one JSON object; no prose before/after.\n- Citations must be context IDs: ^ctx_[0-9]+$ only.\n- If needs_geo_compliance=\"yes\": citations.length ≥ 1.\n- If no qualifying obligation sentence exists: needs_geo_compliance=\"uncertain\".\n- If you cannot produce valid JSON per schema, return exactly: {\"needs_geo_compliance\":\"uncertain\",\"citations\":[]}\n"
    },
    {
      "role": "user",
      "content": "Task: Classify whether this feature needs geo-specific compliance logic according to the provided legal context.\n\nFeature:\n- title: PF default toggle with NR enforcement for California teens\n- description: As part of compliance with California’s SB976, the app will disable PF by default for users under 18 located in California. This default setting is considered NR to override, unless explicit parental opt-in is provided. Geo-detection is handled via GH, and rollout is monitored with FR logs. The design ensures minimal disruption while meeting the strict personalization requirements imposed by the law.\n\nRetrieved legal context (top 4):\n[ctx_1] California, United States — California SB976 — \"Default Settings for Minors **Algorithmic Feeds Restriction:**\"\n[ctx_2] California, United States — California SB976 — \"Track parental consent and control usage This law specifically targets social media platforms operating in California and requires geo-specific implementation to ensure minors in California receive enhanced protections while accessing social media services\"\n[ctx_3] US-FL — Florida House Bill 3 - Social Media Platforms (extract) — \"(2) For accounts held by minors, the social media platform shall: (a) Use heightened privacy settings by default; (b) Prohibit targeted advertising based on the personal information of the minor; (c) Prohibit the collection, use, sharing, or selling of pers...\"\n[ctx_4] California, United States — California SB976 — \"Social media platforms must disable algorithmic or personalized feeds by default for users under 18\"\n# Each card is ONE line: [ctx_N] {JURISDICTION} — {LAW ID} — \"obligation sentence...\"\n\nLabels:\n- needs_geo_compliance ∈ {yes, no, uncertain}\n\nRubric recap:\n- yes: at least one obligation sentence and the feature applies to a jurisdictional subset.\n- no: no legal trigger in context (pure UX/analytics/monetization/experiments).\n- uncertain: no obligation sentence or conflicting/insufficient info.\n\nReturn JSON only, matching this schema.\n"
    }
  ],
  "response_format": {
    "type": "json_schema",
    "json_schema": {
      "schema": {
        "type": "object",
        "properties": {
          "needs_geo_compliance": {
            "type": "string",
            "enum": [
              "yes",
              "no",
              "uncertain"
            ]
          },
          "risk_level": {
            "type": "string",
            "enum": [
              "critical",
              "high",
              "medium",
              "low"
            ]
          },
          "citations": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "minItems": 0
          },
          "reasoning": {
            "type": "string",
            "maxLength": 80
          }
        },
        "required": [
          "needs_geo_compliance",
          "citations"
        ],
        "additionalProperties": false
      }
    }
  }
}